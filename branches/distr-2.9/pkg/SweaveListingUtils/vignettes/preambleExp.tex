\RequirePackage{fancyvrb}
\RequirePackage{listings}
%\usepackage{Sweave}
% -------------------------------------------------------------------------------
% -------------------------------------------------------------------------------
%------------------------------------------------------------------------------%
%Preparations for Sweave and Listings
%------------------------------------------------------------------------------%
%
\RequirePackage{color}
\definecolor{Rcolor}{rgb}{0, 0.5, 0.5}
\definecolor{RRecomdcolor}{rgb}{0, 0.6, 0.4}
\definecolor{Rbcolor}{rgb}{0, 0.6, 0.6}
\definecolor{Routcolor}{rgb}{0.461, 0.039, 0.102}
\definecolor{Rcommentcolor}{rgb}{0.101, 0.043, 0.432}
%------------------------------------------------------------------------------%
\lstdefinelanguage{Rd}[common]{TeX}%
{moretexcs={acronym,alias,arguments,author,bold,cite,%
          code,command,concept,cr,deqn,describe,%
          description,details,dfn,doctype,dots,%
          dontrun,dontshow,donttest,dQuote,%
          email,emph,enc,encoding,enumerate,env,eqn,%
          examples,file,format,item,itemize,kbd,keyword,%
          ldots,link,linkS4class,method,name,note,%
          option,pkg,preformatted,R,Rdopts,Rdversion,%
          references,S3method,S4method,Sexpr,samp,section,%
          seealso,source,sp,special,%
          sQuote,strong,synopsis,tab,tabular,testonly,%
          title,url,usage,value,var,verb},
   sensitive=true,%
   morecomment=[l]\%% 2008/9 Peter Ruckdeschel
}[keywords,comments]%%
%------------------------------------------------------------------------------%
\lstdefinestyle{RstyleO1}{fancyvrb=true,escapechar=§,language=R,%
       % § just for convenience replacing the accent grave
       % (which would escape the rest here, which we do not want for
       % printing out the original code)
                          basicstyle={\color{Rcolor}\small},%
                          keywordstyle={\bf\color{Rcolor}},%
                          commentstyle={\color{Rcommentcolor}\ttfamily\itshape},%
                          literate={<-}{{$\leftarrow$}}2{<<-}{{$\twoheadleftarrow$}}2%
                                        {~}{{$\sim$}}1{<=}{{$\leq$}}2{>=}{{$\geq$}}%
                                        2{^}{{$\scriptstyle\wedge$}}1,%
                          alsoother={$},%
                          alsoletter={.<-},%
                          otherkeywords={!,!=,~,$,*,\&,\%/\%,\%*\%,\%\%,<-,<<-,/},%
                          escapeinside={(*}{*)}}%
% note: we define styles RstyleO<num> incrementally, i.e.
%       \lstdefinestyle{RstyleO<num>}{style = RstyleO<num-1>,
%                                     <further definitions for RstyleO<num> > }
% and then overwrite each time style Rstyle by
%     \lstdefinestyle{Rstyle}{style=RstyleO<num>}
\lstdefinestyle{Rstyle}{style=RstyleO1}
\lstdefinestyle{Rdstyle}{fancyvrb=true,language=Rd,keywordstyle={\bf},%
                         basicstyle={\color{black}\footnotesize},%
                         commentstyle={\ttfamily\itshape},%
                         alsolanguage=R}%
%------------------------------------------------------------------------------%
\global\def\Rlstset{\lstset{style=Rstyle}}%
\global\def\Rdlstset{\lstset{style=Rdstyle}}%
%------------------------------------------------------------------------------%
\global\def\Rinlstset{\lstset{style=Rinstyle}}%
\global\def\Routlstset{\lstset{style=Routstyle}}%
\global\def\Rcodelstset{\lstset{style=Rcodestyle}}%
%------------------------------------------------------------------------------%
\Rlstset
%------------------------------------------------------------------------------%
%copying relevant parts of Sweave.sty
%------------------------------------------------------------------------------%
%
\RequirePackage{graphicx,fancyvrb}%
\IfFileExists{upquote.sty}{\RequirePackage{upquote}}{}%

\RequirePackage{ifthen}%
\newboolean{Sweave@gin}%
\setboolean{Sweave@gin}{true}%
\setkeys{Gin}{width=0.8\textwidth}%
\newboolean{Sweave@ae}
\setboolean{Sweave@ae}{true}%
\RequirePackage[T1]{fontenc}
\RequirePackage{ae}
%
\newenvironment{Schunk}{}{}

\newcommand{\Sconcordance}[1]{%
\ifx\pdfoutput\undefined%
\csname newcount\endcsname\pdfoutput\fi%
\ifcase\pdfoutput\special{#1}%
\else\immediate\pdfobj{#1}\fi}

%------------------------------------------------------------------------------%
% ---- end of parts of Sweave.sty
%------------------------------------------------------------------------------%
%
\lstdefinestyle{RinstyleO}{style=Rstyle,fancyvrb=true,%
                           basicstyle=\color{Rcolor}\small}%
\lstdefinestyle{Rinstyle}{style=Rstyle,fancyvrb=true,%
                          basicstyle=\color{Rcolor}\small}%
\lstnewenvironment{Sinput}{\Rinlstset}{\Rlstset}
\lstdefinestyle{RoutstyleO}{fancyvrb=false,basicstyle=\color{Routcolor}\small}%
\lstdefinestyle{Routstyle}{fancyvrb=false,basicstyle=\color{Routcolor}\small}%
\lstnewenvironment{Soutput}{\Routlstset}{\Rlstset}
\lstdefinestyle{RcodestyleO}{style=Rstyle,fancyvrb=true,fontshape=sl,%
                             basicstyle=\color{Rcolor}}%
\lstdefinestyle{Rcodestyle}{style=Rstyle,fancyvrb=true,fontshape=sl,%
                            basicstyle=\color{Rcolor}}%
\lstnewenvironment{Scode}{\Rcodelstset}{\Rlstset}
%------------------------------------------------------------------------------%
\let\code\lstinline
\def\Code#1{{\tt\color{Rcolor} #1}}
\def\file#1{{\tt #1}}
\def\pkg#1{{\tt "#1"}}
\newcommand{\pkgversion}{{\tt 2.2}}
\lstdefinestyle{RstyleO2}{style=RstyleO1,%
% --------------------------
% Registration of package SweaveListingUtils
% --------------------------
morekeywords={[2]taglist,SweaveListingPreparations,SweaveListingOptions,%
SweaveListingoptions,SweaveListingMASK,setToBeDefinedPkgs,setBaseOrRecommended,%
readSourceFromRForge,readPkgVersion,lstsetRout,lstsetRin,lstsetRd,lstsetRcode,%
lstsetR,lstsetLanguage,lstset,lstinputSourceFromRForge,isBaseOrRecommended,%
getSweaveListingOption,copySourceFromRForge,changeKeywordstyles%
},%
keywordstyle={[2]{\bf}},%
%
% --------------------------
% Registration of package startupmsg
% --------------------------
morekeywords={[3]suppressStartupMessages,startupType,startupPackage,%
StartupMessage,startupMessage,startupEndline,readVersionInformation,%
readURLInformation,pointertoNEWS,onlytypeStartupMessages,%
NEWS,mystartupMessage,mySMHandler,infoShow,buildStartupMessage%
},%
keywordstyle={[3]{\bf}},%
%
% --------------------------
%
...
snipped expanded (`\TeX`) (see how the original `(\verb|(`\TeX`)|)` gets escaped!)
code for registration of packages
        tools, stats, graphics, grDevices, utils, datasets, methods, base
...
%

},%
keywordstyle={[11]{\bf\color{RRecomdcolor}}}%
%
}%
\lstdefinestyle{Rstyle}{style=RstyleO2}
%
%------------------------------------------------------------------------------%
